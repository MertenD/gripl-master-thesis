\section{API-Design}\label{sec:api-design}

Dieses Kapitel beschreibt das API-Design der Klassifizierungspipeline, die zur Erkennung \ac{DSGVO}-kritischer Elemente in \ac{BPMN}-Modellen dient. Das Ziel ist es eine standardisierte Schnittstelle zu definieren, um

\begin{enumerate}
    \item die Einbindung in bestehende Werkzeuge und das Evaluationsframework (siehe Kapitel \ref{ch:evaluationsframework}) zu vereinfachen,
    \item die Austauschbarkeit unterschiedlicher Klassifizierungsalgorithmen - insbesondere im Evaluationsframework - zu ermöglichen, um verschiedene Ansätze vergleichen zu können, und
    \item Erweiterbarkeit zu fördern, sodass zukünftige Arbeiten die Schnittstelle wiederverwenden können, um ihre eigenen Klassifizierungsalgorithmen zu integrieren.
\end{enumerate}

\subsection*{HTTP-Endpunkt}

Die Klassifizierungspipeline ist über einen HTTP-Endpunkt nutzbar, der im Folgenden definiert wird. Der \texttt{POST}-Endpunkt akzeptiert \texttt{multipart/form-data} mit den folgenden Teilen:

\begin{description}
    \item[\texttt{bpmnFile} (Pflicht)] Eine BPMN-2.0-XML-Datei (\texttt{.bpmn} oder \texttt{text/xml}), die den zu analysierenden Prozess beinhaltet.
    \item[\texttt{llmProps} (Optional)] Ein JSON-Objekt zur Überschreibung von \ac{LLM}-Eigenschaften zur Laufzeit. Siehe Listing \ref{lst:api-request-schema} für das JSON-Schema. Wird nichts angegeben, nutzt die Pipeline Standardwerte.
\end{description}

Die \texttt{llmProps} erlauben es, verschiedene \acp{LLM} und deren Konfigurationen flexibel für die Klassifizierung zu nutzen, ohne die Anwendung neu starten zu müssen. Dies ist besonders nützlich im Evaluationsframework, um verschiedene Modelle zu vergleichen.

\begin{lstlisting}[caption={JSON-Schema der \texttt{llmProps}.},label={lst:api-request-schema}]
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "LlmProps",
  "type": "object",
  "properties": {
    "baseUrl": {"type": "string"},
    "modelName": { "type": "string" },
    "apiKey": { "type": "string" },
    "timeoutSeconds": { "type": "number" },
    "seed": { "type": "number" },
    "temperature": { "type": "number" },
    "topP": { "type": "number" }
  },
  "required": []
}
\end{lstlisting}

Die Antwort des Endpunkts wird als \texttt{application/json} geliefert und enthält eine Liste der als \ac{DSGVO}-kritisch klassifizierten Elemente, einschließlich einer optionalen Begründung für jede Klassifikation und einem optionalen Namen des Elements für bessere Lesbarkeit. Das JSON-Schema der API-Antwort ist in Listing \ref{lst:api-response-schema} dargestellt.

\begin{lstlisting}[caption={JSON-Schema der API-Antwort.},label={lst:api-response-schema}]
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "BpmnAnalysisResult",
  "type": "object",
  "properties": {
    "criticalElements": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "reason": { "type": "string" }
        },
        "required": ["id"]
      }
    }
  },
  "required": ["criticalElements"]
}
\end{lstlisting}

Ein Beispielaufruf des Klassifizierungsendpunkts mit \texttt{curl} könnte wie in Listing \ref{lst:api-curl-example} aussehen. Dabei wird eine BPMN-Datei hochgeladen und einige \ac{LLM}-Eigenschaften zur Laufzeit überschrieben, damit das Modell \texttt{mistral-small-latest} von Mistral AI verwendet wird.

\begin{lstlisting}[language=bash,caption={Beispielaufruf des Klassifizierungsendpunkts mit \texttt{curl}.},label={lst:api-curl-example}]
curl -X POST http://localhost:8080/gdpr/analysis/prompt-engineering \
    -F 'bpmnFile=@/path/to/process.bpmn' \
    -F 'llmProps={
        "baseUrl": "https://api.mistral.ai/v1",
        "modelName": "mistral-small-latest",
        "apiKey": "******"
    }'
\end{lstlisting}

\subsection*{Integration und Erweiterbarkeit}

Die gewählte API-Struktur mit einem standardisierten HTTP-Endpunkt und klar definierten JSON-Schemas ermöglicht eine einfache Integration in bestehende Werkzeuge und das Evaluationsframework (siehe Kapitel \ref{ch:evaluationsframework}). Durch die Möglichkeit, verschiedene \ac{LLM}-Eigenschaften zur Laufzeit zu überschreiben, können unterschiedliche Modelle mit einem Klassifizierungsalgorithmus flexibel getestet und verglichen werden, ohne die Anwendung neu starten zu müssen.

Zukünftige Arbeiten können die gleiche API nutzen, um ihre eigenen Klassifizierungsalgorithmen zu integrieren und so eine Vergleichbarkeit der Ergebnisse zu gewährleisten.